<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Numerology Calculator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: radial-gradient(1200px 600px at 20% 0%, #fff6d6 0%, #f6f8f7 40%, #f2f5f4 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 48px 20px 80px;
            color: #0f172a;
        }

        .container { max-width: 1120px; width: 100%; }

        .header {
            text-align: center;
            margin-bottom: 28px;
            animation: fadeInDown 0.6s ease;
        }

        .brand {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
        }
        .brand-icon { filter: drop-shadow(0 1px 0 rgba(0,0,0,0.04)); }
        .title { letter-spacing: .2px; }
        .subtitle { margin-top: 6px; opacity: .75; font-weight: 500; }

        .card {
            background: linear-gradient(180deg, #ffffff 0%, #fbfcfb 70%, #f7f9f8 100%);
            border-radius: 16px;
            padding: 28px;
            border: 1px solid rgba(15,23,42,0.06);
            box-shadow: 0 8px 24px rgba(2,8,20,0.06), 0 1px 0 rgba(2,8,20,0.04) inset;
            animation: fadeInUp 0.6s ease;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 0.95em;
        }

        input[type="text"],
        input[type="date"],
        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        input[type="text"]:focus,
        input[type="date"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .radio-group { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-top: 10px; }
        .seg { position: relative; border: 1px solid rgba(15,23,42,.08); border-radius: 12px; padding: 14px 16px; background: #fff; cursor: pointer; font-weight: 600; text-align: center; }
        .seg input { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
        .seg.active { outline: 2px solid rgba(15,115,95,0.25); background: linear-gradient(180deg,#ffffff 0%,#eef7f3 100%); }

        .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-top: 10px; }
        .btn { padding: 14px 16px; border: 1px solid rgba(15,23,42,.06); border-radius: 12px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: transform .15s ease, box-shadow .15s ease; }
        .btn-primary { background: #0E5B4D; color: #fff; border-color: #0E5B4D; }
        .btn-secondary { background: #f6f7f7; color: #0f172a; }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 8px 20px rgba(2,8,20,.08); }
        .btn:active { transform: translateY(0); box-shadow: none; }

        .results {
            margin-top: 30px;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .results.show {
            display: block;
        }

        .result-header { margin: 24px 0; }
        .result-banner { display:flex; align-items:center; justify-content: space-between; gap:16px; padding:16px 18px; border:1px solid rgba(15,23,42,.06); background: linear-gradient(180deg,#ffffff 0%,#fffaf0 100%); border-radius:12px; }
        .result-meta { font-weight: 700; }
        .result-meta small { display:block; opacity:.7; font-weight: 600; }

        .numbers-grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:16px; margin-bottom: 22px; }
        .number-card { background: linear-gradient(180deg,#ffffff 0%,#f3f6f9 100%); padding:18px; border-radius:12px; border:1px solid rgba(15,23,42,.06); text-align:center; }

        .number-card:hover {
            transform: translateY(-5px);
        }

        .number-card h3 {
            color: #667eea;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .number-card .value {
            font-size: 3em;
            font-weight: bold;
            color: #333;
        }

        .loshu-section { margin-top: 30px; }

        .loshu-section h3 {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .loshu-grid { display: grid; grid-template-columns: repeat(3, 96px); justify-content: center; gap: 14px; padding: 26px; background: linear-gradient(180deg,#ffffff 0%,#fbfbf6 100%); border:1px solid rgba(15,23,42,.06); border-radius:16px; }
        .loshu-cell { position:relative; width:96px; height:96px; display:flex; align-items:center; justify-content:center; font-size:28px; font-weight:800; color:#475569; border-radius:12px; border:1px solid rgba(15,23,42,.08); background:#fff; }
        .loshu-cell.present { background: linear-gradient(180deg,#fff 0%,#fffaf0 100%); color:#9a6b00; border-color: #f1c663; box-shadow: inset 0 0 0 2px #f1c663; }
        .loshu-cell.missing { opacity: .55; }
        .loshu-count { position:absolute; right:8px; top:6px; font-size:12px; font-weight:700; opacity:.7; }

        .loshu-cell:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .missing-numbers {
            margin-top: 20px;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe0e0 100%);
            border-radius: 15px;
            border: 2px dashed #ff6b6b;
        }

        .missing-numbers h4 {
            color: #d32f2f;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .missing-numbers-list {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .missing-number-badge {
            background: #ff6b6b;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(255, 107, 107, 0.3);
        }

        .present-numbers {
            margin-top: 15px;
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #f0fff4 0%, #dcfce7 100%);
            border-radius: 15px;
            border: 2px solid #84fab0;
        }

        .present-numbers h4 {
            color: #1a5928;
            font-size: 1em;
            margin-bottom: 8px;
        }

        .present-numbers p {
            color: #2d6a3e;
            font-size: 1.1em;
            font-weight: 600;
        }

        .compatibility-section {
            margin-top: 40px;
        }

        .compatibility-section h3 {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 25px;
            text-align: center;
        }

        .compatibility-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .compatibility-card {
            background: linear-gradient(135deg, #f6f8fb 0%, #e9ecf4 100%);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #667eea;
        }

        .compatibility-card h4 {
            color: #667eea;
            font-size: 1.2em;
            margin-bottom: 15px;
            text-align: center;
        }

        .compatibility-card .planet-name {
            text-align: center;
            color: #555;
            font-size: 0.95em;
            margin-bottom: 15px;
            font-style: italic;
        }

        .compatibility-item {
            margin-bottom: 15px;
        }

        .compatibility-item h5 {
            font-size: 0.9em;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .compatibility-item.friends h5 {
            color: #2d6a3e;
        }

        .compatibility-item.non-friends h5 {
            color: #d32f2f;
        }

        .compatibility-item.neutral h5 {
            color: #f57c00;
        }

        .number-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .number-badge {
            background: #667eea;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95em;
        }

        .number-badge.friends {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            color: #1a5928;
        }

        .number-badge.non-friends {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa07a 100%);
            color: white;
        }

        .number-badge.neutral {
            background: linear-gradient(135deg, #ffd89b 0%, #ffb347 100%);
            color: #7d4e00;
        }

        .summary-section {
            margin-top: 40px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .summary-section h3 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 25px;
            text-align: center;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .summary-card {
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .summary-card.lucky {
            background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
            border: 3px solid #4caf50;
        }

        .summary-card.bad {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            border: 3px solid #f44336;
        }

        .summary-card.neutral-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border: 3px solid #ff9800;
        }

        .summary-card h4 {
            font-size: 1.3em;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .summary-card.lucky h4 {
            color: #1b5e20;
        }

        .summary-card.bad h4 {
            color: #b71c1c;
        }

        .summary-card.neutral-card h4 {
            color: #e65100;
        }

        .summary-numbers {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 15px;
        }

        .summary-number {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .summary-number.lucky {
            background: #4caf50;
            color: white;
        }

        .summary-number.bad {
            background: #f44336;
            color: white;
        }

        .summary-number.neutral-num {
            background: #ff9800;
            color: white;
        }

        .remedies-section {
            margin-top: 40px;
        }

        .remedies-section h3 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 10px;
            text-align: center;
        }

        .remedies-section .subtitle {
            text-align: center;
            color: #666;
            font-size: 1em;
            margin-bottom: 25px;
            font-style: italic;
        }

        .remedy-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-left: 5px solid #ff6b6b;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .remedy-card .condition {
            font-weight: 600;
            color: #d32f2f;
            font-size: 1em;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .remedy-card .remedy-text {
            color: #333;
            font-size: 1.05em;
            line-height: 1.6;
        }

        .no-remedies {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);
            border-radius: 15px;
            color: #00695c;
            font-size: 1.1em;
        }

        .remedies-part3 {
            margin-top: 30px;
        }

        .remedies-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .remedies-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .remedies-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 1em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .remedies-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .remedies-table tbody tr:hover {
            background: #f5f7fa;
        }

        .remedies-table tbody tr:last-child td {
            border-bottom: none;
        }

        .remedies-table .number-col {
            font-weight: bold;
            color: #667eea;
            font-size: 1.2em;
            width: 80px;
            text-align: center;
        }

        .remedies-table .planet-col {
            font-weight: 600;
            color: #333;
            width: 150px;
        }

        .remedies-table .remedy-col {
            color: #555;
            line-height: 1.8;
        }

        .remedies-table .remedy-col ul {
            margin: 0;
            padding-left: 20px;
        }

        .remedies-table .remedy-col li {
            margin-bottom: 5px;
        }

        .luck-factor-section {
            margin-top: 40px;
        }

        .luck-factor-section h3 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 25px;
            text-align: center;
        }

        .luck-factor-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .luck-factor-table thead {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .luck-factor-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 1em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .luck-factor-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .luck-factor-table tbody tr:hover {
            background: #fff5f8;
        }

        .luck-factor-table tbody tr:last-child td {
            border-bottom: none;
        }

        .luck-factor-table .year-col {
            font-weight: bold;
            color: #f5576c;
            font-size: 1.1em;
            width: 100px;
        }

        .luck-factor-table .combination-col {
            font-weight: 600;
            color: #667eea;
            font-size: 1em;
            width: 120px;
        }

        .luck-factor-table .percentage-col {
            font-weight: bold;
            color: #2d6a3e;
            font-size: 1.2em;
            width: 150px;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        .error.show {
            display: block;
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.8em;
            }

            .card {
                padding: 25px;
            }

            .loshu-cell {
                width: 60px;
                height: 60px;
                font-size: 1.5em;
            }

            .numbers-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="brand">
                <span class="brand-icon">✨</span>
                <h1 class="title">Numerology Calculator</h1>
            </div>
            <p class="subtitle">Discover the hidden patterns in your numbers and unlock insights about your personality, life path, and destiny</p>
        </div>

        <div class="card">
            <form id="numerologyForm">
                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" name="name" required placeholder="Enter your full name">
                </div>

                <div class="form-group">
                    <label for="dob">Date of Birth</label>
                    <input type="date" id="dob" name="dob" required>
                </div>

                <div class="form-group">
                    <label>Gender</label>
                    <div class="radio-group">
                        <label class="seg" id="segMale">
                            <input type="radio" id="male" name="gender" value="male" required>
                            ♂ Male
                        </label>
                        <label class="seg" id="segFemale">
                            <input type="radio" id="female" name="gender" value="female" required>
                            ♀ Female
                        </label>
                    </div>
                </div>

                <div class="actions">
                    <button type="button" id="resetBtn" class="btn btn-secondary">Reset</button>
                    <button type="submit" class="btn btn-primary">Calculate</button>
                </div>
            </form>

            <div class="error" id="error"></div>

            <div class="results" id="results">
                <div class="result-header">
                    <div class="result-banner">
                        <div class="result-meta">
                            <div id="resultName"></div>
                            <small id="resultDob"></small>
                        </div>
                        <div class="result-actions">
                            <!-- purely visual placeholders to match layout; functionality unchanged -->
                            <button type="button" class="btn btn-secondary" disabled>Copy JSON</button>
                            <button type="button" class="btn btn-secondary" disabled>Export PDF</button>
                            <button type="button" class="btn btn-secondary" id="newReadingBtn">New Reading</button>
                        </div>
                    </div>
                </div>

                <div class="numbers-grid">
                    <div class="number-card">
                        <h3>Driver Number</h3>
                        <div class="value" id="driverValue">-</div>
                    </div>
                    <div class="number-card">
                        <h3>Conductor Number</h3>
                        <div class="value" id="conductorValue">-</div>
                    </div>
                    <div class="number-card">
                        <h3>Kua Number</h3>
                        <div class="value" id="kuaValue">-</div>
                    </div>
                </div>

                <div class="loshu-section">
                    <h3>Your Personalized Loshu Grid</h3>
                    <div class="loshu-grid" id="loshuGrid"></div>

                    <div class="present-numbers" id="presentNumbers">
                        <h4>Numbers Present in Your Life</h4>
                        <p id="presentNumbersList"></p>
                    </div>

                    <div class="missing-numbers" id="missingNumbers">
                        <h4>Missing Numbers</h4>
                        <div class="missing-numbers-list" id="missingNumbersList"></div>
                    </div>
                </div>

                <div class="compatibility-section">
                    <h3>Number Compatibility</h3>
                    <div class="compatibility-grid">
                        <div class="compatibility-card">
                            <h4>Driver Number <span id="driverNumCompat"></span></h4>
                            <div class="planet-name" id="driverPlanet"></div>
                            <div class="compatibility-item friends">
                                <h5>Friends</h5>
                                <div class="number-badges" id="driverFriends"></div>
                            </div>
                            <div class="compatibility-item non-friends">
                                <h5>Non-Friends</h5>
                                <div class="number-badges" id="driverNonFriends"></div>
                            </div>
                            <div class="compatibility-item neutral">
                                <h5>Neutral</h5>
                                <div class="number-badges" id="driverNeutral"></div>
                            </div>
                        </div>

                        <div class="compatibility-card">
                            <h4>Conductor Number <span id="conductorNumCompat"></span></h4>
                            <div class="planet-name" id="conductorPlanet"></div>
                            <div class="compatibility-item friends">
                                <h5>Friends</h5>
                                <div class="number-badges" id="conductorFriends"></div>
                            </div>
                            <div class="compatibility-item non-friends">
                                <h5>Non-Friends</h5>
                                <div class="number-badges" id="conductorNonFriends"></div>
                            </div>
                            <div class="compatibility-item neutral">
                                <h5>Neutral</h5>
                                <div class="number-badges" id="conductorNeutral"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="summary-section">
                    <h3>Your Numbers Summary</h3>
                    <div class="summary-grid">
                        <div class="summary-card lucky">
                            <h4>Lucky Numbers</h4>
                            <div class="summary-numbers" id="luckyNumbersSummary"></div>
                        </div>
                        <div class="summary-card bad">
                            <h4>Bad Numbers</h4>
                            <div class="summary-numbers" id="badNumbersSummary"></div>
                        </div>
                        <div class="summary-card neutral-card">
                            <h4>Neutral Numbers</h4>
                            <div class="summary-numbers" id="neutralNumbersSummary"></div>
                        </div>
                    </div>
                </div>

                <div class="remedies-section">
                    <h3>Remedies for Missing Numbers</h3>
                    <p class="subtitle">Part 1: Based on your Loshu Grid</p>
                    <div id="remediesPart1Container"></div>

                    <div class="remedies-part3" style="margin-top: 30px;">
                        <p class="subtitle">Part 2: Yantra-Based Remedies</p>
                        <div id="remediesPart2Container"></div>
                    </div>

                    <div class="remedies-part3">
                        <p class="subtitle">Part 3: Planet-Based Remedies (Tabular Format)</p>
                        <div id="remediesPart3Container"></div>
                    </div>
                </div>

                <div class="luck-factor-section">
                    <h3>Luck Factor - Next 6 Years</h3>
                    <p class="subtitle">Personal Year (PY) + Driver (D) = Luck Percentage</p>
                    <div id="luckFactorContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('numerologyForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('name').value;
            const dob = document.getElementById('dob').value;
            const gender = document.querySelector('input[name="gender"]:checked').value;

            const errorDiv = document.getElementById('error');
            const resultsDiv = document.getElementById('results');

            errorDiv.classList.remove('show');
            resultsDiv.classList.remove('show');

            try {
                const response = await fetch('/calculate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: name,
                        date_of_birth: dob,
                        gender: gender
                    })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('resultName').textContent = data.name;
                    document.getElementById('resultDob').textContent = `Born on ${new Date(data.date_of_birth).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}`;

                    document.getElementById('driverValue').textContent = data.driver;
                    document.getElementById('conductorValue').textContent = data.conductor;
                    document.getElementById('kuaValue').textContent = data.kua;

                    // Populate Loshu Grid
                    const loshuGrid = document.getElementById('loshuGrid');
                    loshuGrid.innerHTML = '';
                    data.loshu_grid.forEach(row => {
                        row.forEach(cell => {
                            const cellDiv = document.createElement('div');
                            cellDiv.className = 'loshu-cell';
                            if (cell.present) {
                                cellDiv.classList.add('present');
                            } else {
                                cellDiv.classList.add('missing');
                            }
                            // Visual: show base number and count badge (xN)
                            const base = String(cell.value).charAt(0);
                            cellDiv.textContent = base;
                            if (cell.count && cell.count > 1) {
                                const badge = document.createElement('span');
                                badge.className = 'loshu-count';
                                badge.textContent = `×${cell.count}`;
                                cellDiv.appendChild(badge);
                            }
                            loshuGrid.appendChild(cellDiv);
                        });
                    });

                    // Populate present numbers
                    const presentNumbersList = document.getElementById('presentNumbersList');
                    presentNumbersList.textContent = data.present_numbers.join(', ');

                    // Populate missing numbers
                    const missingNumbersList = document.getElementById('missingNumbersList');
                    missingNumbersList.innerHTML = '';
                    if (data.missing_numbers.length > 0) {
                        data.missing_numbers.forEach(num => {
                            const badge = document.createElement('div');
                            badge.className = 'missing-number-badge';
                            badge.textContent = num;
                            missingNumbersList.appendChild(badge);
                        });
                        document.getElementById('missingNumbers').style.display = 'block';
                    } else {
                        document.getElementById('missingNumbers').style.display = 'none';
                    }

                    // Populate Driver Compatibility
                    if (data.driver_compatibility) {
                        document.getElementById('driverNumCompat').textContent = data.driver;
                        document.getElementById('driverPlanet').textContent = data.driver_compatibility.planet || '';

                        const driverFriendsDiv = document.getElementById('driverFriends');
                        driverFriendsDiv.innerHTML = '';
                        const friendsRaw = data.driver_compatibility.friends_raw || '';
                        if (friendsRaw) {
                            const badge = document.createElement('div');
                            badge.className = 'number-badge friends';
                            badge.textContent = friendsRaw;
                            badge.style.width = 'auto';
                            badge.style.padding = '8px 12px';
                            driverFriendsDiv.appendChild(badge);
                        }

                        const driverNonFriendsDiv = document.getElementById('driverNonFriends');
                        driverNonFriendsDiv.innerHTML = '';
                        const nonFriendsRaw = data.driver_compatibility.non_friends_raw || '';
                        if (nonFriendsRaw && nonFriendsRaw !== '--------') {
                            const badge = document.createElement('div');
                            badge.className = 'number-badge non-friends';
                            badge.textContent = nonFriendsRaw;
                            badge.style.width = 'auto';
                            badge.style.padding = '8px 12px';
                            driverNonFriendsDiv.appendChild(badge);
                        } else {
                            driverNonFriendsDiv.textContent = 'None';
                            driverNonFriendsDiv.style.color = '#999';
                        }

                        const driverNeutralDiv = document.getElementById('driverNeutral');
                        driverNeutralDiv.innerHTML = '';
                        const neutralRaw = data.driver_compatibility.neutral_raw || '';
                        if (neutralRaw) {
                            const badge = document.createElement('div');
                            badge.className = 'number-badge neutral';
                            badge.textContent = neutralRaw;
                            badge.style.width = 'auto';
                            badge.style.padding = '8px 12px';
                            driverNeutralDiv.appendChild(badge);
                        }
                    }

                    // Populate Conductor Compatibility
                    if (data.conductor_compatibility) {
                        document.getElementById('conductorNumCompat').textContent = data.conductor;
                        document.getElementById('conductorPlanet').textContent = data.conductor_compatibility.planet || '';

                        const conductorFriendsDiv = document.getElementById('conductorFriends');
                        conductorFriendsDiv.innerHTML = '';
                        const friendsRaw = data.conductor_compatibility.friends_raw || '';
                        if (friendsRaw) {
                            const badge = document.createElement('div');
                            badge.className = 'number-badge friends';
                            badge.textContent = friendsRaw;
                            badge.style.width = 'auto';
                            badge.style.padding = '8px 12px';
                            conductorFriendsDiv.appendChild(badge);
                        }

                        const conductorNonFriendsDiv = document.getElementById('conductorNonFriends');
                        conductorNonFriendsDiv.innerHTML = '';
                        const nonFriendsRaw = data.conductor_compatibility.non_friends_raw || '';
                        if (nonFriendsRaw && nonFriendsRaw !== '--------') {
                            const badge = document.createElement('div');
                            badge.className = 'number-badge non-friends';
                            badge.textContent = nonFriendsRaw;
                            badge.style.width = 'auto';
                            badge.style.padding = '8px 12px';
                            conductorNonFriendsDiv.appendChild(badge);
                        } else {
                            conductorNonFriendsDiv.textContent = 'None';
                            conductorNonFriendsDiv.style.color = '#999';
                        }

                        const conductorNeutralDiv = document.getElementById('conductorNeutral');
                        conductorNeutralDiv.innerHTML = '';
                        const neutralRaw = data.conductor_compatibility.neutral_raw || '';
                        if (neutralRaw) {
                            const badge = document.createElement('div');
                            badge.className = 'number-badge neutral';
                            badge.textContent = neutralRaw;
                            badge.style.width = 'auto';
                            badge.style.padding = '8px 12px';
                            conductorNeutralDiv.appendChild(badge);
                        }
                    }

                    // Populate Lucky Numbers Summary
                    const luckyNumbersSummary = document.getElementById('luckyNumbersSummary');
                    luckyNumbersSummary.innerHTML = '';
                    if (data.lucky_numbers && data.lucky_numbers.length > 0) {
                        data.lucky_numbers.forEach(num => {
                            const numDiv = document.createElement('div');
                            numDiv.className = 'summary-number lucky';
                            numDiv.textContent = num;
                            luckyNumbersSummary.appendChild(numDiv);
                        });
                    } else {
                        luckyNumbersSummary.innerHTML = '<p style="color: #999;">None</p>';
                    }

                    // Populate Bad Numbers Summary
                    const badNumbersSummary = document.getElementById('badNumbersSummary');
                    badNumbersSummary.innerHTML = '';
                    if (data.bad_numbers && data.bad_numbers.length > 0) {
                        data.bad_numbers.forEach(num => {
                            const numDiv = document.createElement('div');
                            numDiv.className = 'summary-number bad';
                            numDiv.textContent = num;
                            badNumbersSummary.appendChild(numDiv);
                        });
                    } else {
                        badNumbersSummary.innerHTML = '<p style="color: #999;">None</p>';
                    }

                    // Populate Neutral Numbers Summary
                    const neutralNumbersSummary = document.getElementById('neutralNumbersSummary');
                    neutralNumbersSummary.innerHTML = '';
                    if (data.neutral_numbers && data.neutral_numbers.length > 0) {
                        data.neutral_numbers.forEach(num => {
                            const numDiv = document.createElement('div');
                            numDiv.className = 'summary-number neutral-num';
                            numDiv.textContent = num;
                            neutralNumbersSummary.appendChild(numDiv);
                        });
                    } else {
                        neutralNumbersSummary.innerHTML = '<p style="color: #999;">None</p>';
                    }

                    // Populate Remedies Part 1
                    const remediesPart1Container = document.getElementById('remediesPart1Container');
                    remediesPart1Container.innerHTML = '';
                    if (data.remedies_part1 && data.remedies_part1.length > 0) {
                        data.remedies_part1.forEach(remedy => {
                            const remedyCard = document.createElement('div');
                            remedyCard.className = 'remedy-card';

                            const conditionDiv = document.createElement('div');
                            conditionDiv.className = 'condition';
                            conditionDiv.textContent = 'If ' + remedy.condition;

                            const remedyDiv = document.createElement('div');
                            remedyDiv.className = 'remedy-text';
                            remedyDiv.textContent = remedy.remedy;

                            remedyCard.appendChild(conditionDiv);
                            remedyCard.appendChild(remedyDiv);
                            remediesPart1Container.appendChild(remedyCard);
                        });
                    } else {
                        remediesPart1Container.innerHTML = '<div class="no-remedies">No missing numbers! Your Loshu Grid is complete.</div>';
                    }

                    // Populate Remedies Part 2
                    const remediesPart2Container = document.getElementById('remediesPart2Container');
                    remediesPart2Container.innerHTML = '';
                    if (data.remedies_part2 && data.remedies_part2.length > 0) {
                        data.remedies_part2.forEach(remedy => {
                            const remedyCard = document.createElement('div');
                            remedyCard.className = 'remedy-card';

                            const remedyTitle = document.createElement('div');
                            remedyTitle.className = 'condition';
                            remedyTitle.textContent = remedy.remedy;

                            const conditionDiv = document.createElement('div');
                            conditionDiv.className = 'remedy-text';
                            conditionDiv.textContent = 'Condition: ' + remedy.condition;

                            remedyCard.appendChild(remedyTitle);
                            remedyCard.appendChild(conditionDiv);
                            remediesPart2Container.appendChild(remedyCard);
                        });
                    } else {
                        remediesPart2Container.innerHTML = '<div class="no-remedies">No Yantra-based remedies applicable.</div>';
                    }

                    // Populate Remedies Part 3
                    const remediesPart3Container = document.getElementById('remediesPart3Container');
                    remediesPart3Container.innerHTML = '';
                    if (data.remedies_part3 && data.remedies_part3.length > 0) {
                        const table = document.createElement('table');
                        table.className = 'remedies-table';

                        // Create table header
                        const thead = document.createElement('thead');
                        thead.innerHTML = `
                            <tr>
                                <th>No.</th>
                                <th>Planet</th>
                                <th>Remedy / Action</th>
                            </tr>
                        `;
                        table.appendChild(thead);

                        // Create table body
                        const tbody = document.createElement('tbody');
                        data.remedies_part3.forEach(item => {
                            const tr = document.createElement('tr');

                            // Number column
                            const tdNum = document.createElement('td');
                            tdNum.className = 'number-col';
                            tdNum.textContent = item.number;

                            // Planet column
                            const tdPlanet = document.createElement('td');
                            tdPlanet.className = 'planet-col';
                            tdPlanet.textContent = item.planet;

                            // Remedies column
                            const tdRemedies = document.createElement('td');
                            tdRemedies.className = 'remedy-col';

                            if (item.remedies.length === 1) {
                                tdRemedies.textContent = item.remedies[0];
                            } else {
                                const ul = document.createElement('ul');
                                item.remedies.forEach(remedy => {
                                    const li = document.createElement('li');
                                    li.textContent = remedy;
                                    ul.appendChild(li);
                                });
                                tdRemedies.appendChild(ul);
                            }

                            tr.appendChild(tdNum);
                            tr.appendChild(tdPlanet);
                            tr.appendChild(tdRemedies);
                            tbody.appendChild(tr);
                        });
                        table.appendChild(tbody);
                        remediesPart3Container.appendChild(table);
                    } else {
                        remediesPart3Container.innerHTML = '<div class="no-remedies">No missing numbers! No planet-based remedies needed.</div>';
                    }

                    // Populate Luck Factor
                    const luckFactorContainer = document.getElementById('luckFactorContainer');
                    luckFactorContainer.innerHTML = '';
                    if (data.luck_factors && data.luck_factors.length > 0) {
                        const table = document.createElement('table');
                        table.className = 'luck-factor-table';

                        // Create table header
                        const thead = document.createElement('thead');
                        thead.innerHTML = `
                            <tr>
                                <th>Year</th>
                                <th>Date</th>
                                <th>PY, D</th>
                                <th>Luck Factor</th>
                            </tr>
                        `;
                        table.appendChild(thead);

                        // Create table body
                        const tbody = document.createElement('tbody');
                        data.luck_factors.forEach(item => {
                            const tr = document.createElement('tr');

                            // Year column
                            const tdYear = document.createElement('td');
                            tdYear.className = 'year-col';
                            tdYear.textContent = item.year;

                            // Date column
                            const tdDate = document.createElement('td');
                            tdDate.textContent = item.date;

                            // Combination column
                            const tdCombination = document.createElement('td');
                            tdCombination.className = 'combination-col';
                            tdCombination.textContent = item.combination;

                            // Luck percentage column
                            const tdPercentage = document.createElement('td');
                            tdPercentage.className = 'percentage-col';
                            tdPercentage.textContent = item.luck_factor;

                            tr.appendChild(tdYear);
                            tr.appendChild(tdDate);
                            tr.appendChild(tdCombination);
                            tr.appendChild(tdPercentage);
                            tbody.appendChild(tr);
                        });
                        table.appendChild(tbody);
                        luckFactorContainer.appendChild(table);
                    }

                    resultsDiv.classList.add('show');
                    resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    errorDiv.textContent = 'Error: ' + data.error;
                    errorDiv.classList.add('show');
                }
            } catch (error) {
                errorDiv.textContent = 'An error occurred. Please try again.';
                errorDiv.classList.add('show');
            }
            // toggle gender segmented visuals
            const male = document.getElementById('male');
            const female = document.getElementById('female');
            const segMale = document.getElementById('segMale');
            const segFemale = document.getElementById('segFemale');
            function syncSegs(){
                segMale.classList.toggle('active', male.checked);
                segFemale.classList.toggle('active', female.checked);
            }
            male.addEventListener('change', syncSegs);
            female.addEventListener('change', syncSegs);
            syncSegs();

            // reset button visual behavior only
            const resetBtn = document.getElementById('resetBtn');
            const newReadingBtn = document.getElementById('newReadingBtn');
            function resetForm(){
                document.getElementById('numerologyForm').reset();
                document.getElementById('results').classList.remove('show');
                document.getElementById('error').classList.remove('show');
                syncSegs();
                window.scrollTo({top:0, behavior:'smooth'});
            }
            resetBtn.addEventListener('click', resetForm);
            if (newReadingBtn) newReadingBtn.addEventListener('click', resetForm);
        });
    </script>
</body>
</html>
